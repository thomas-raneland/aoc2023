import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.function.ToIntFunction;

public class Day11 {
    record Galaxy(int x, int y) {}

    public static void main(String... args) {
        for (String input : List.of(TEST_INPUT, INPUT)) {
            var galaxies = parse(input);

            for (long weight : List.of(2, 10, 1_000_000)) {
                var xMapping = mapping(galaxies, g -> g.x, weight);
                var yMapping = mapping(galaxies, g -> g.y, weight);
                var total = totalDistance(galaxies, xMapping, yMapping);
                System.out.println(weight + ": " + total);
            }
        }
    }

    static List<Galaxy> parse(String input) {
        List<Galaxy> galaxies = new ArrayList<>();
        List<String> lines = input.lines().toList();

        for (int y = 0; y < lines.size(); y++) {
            for (int x = 0; x < lines.get(y).length(); x++) {
                if (lines.get(y).charAt(x) == '#') {
                    galaxies.add(new Galaxy(x, y));
                }
            }
        }

        return galaxies;
    }

    static Map<Integer, Long> mapping(List<Galaxy> galaxies, ToIntFunction<Galaxy> coordFunction, long weight) {
        Map<Integer, Long> map = new HashMap<>();
        long bonus = 0;
        int prevCoord = -1;

        for (int coord : galaxies.stream().mapToInt(coordFunction).sorted().distinct().toArray()) {
            bonus += (coord - prevCoord - 1) * (weight - 1);
            map.put(coord, coord + bonus);
            prevCoord = coord;
        }

        return map;
    }

    static long totalDistance(List<Galaxy> galaxies, Map<Integer, Long> xMapping, Map<Integer, Long> yMapping) {
        long total = 0;

        for (var a : galaxies) {
            for (var b : galaxies.subList(galaxies.indexOf(a) + 1, galaxies.size())) {
                total += Math.abs(xMapping.get(a.x) - xMapping.get(b.x));
                total += Math.abs(yMapping.get(a.y) - yMapping.get(b.y));
            }
        }

        return total;
    }

    private static final String TEST_INPUT = """
            ...#......
            .......#..
            #.........
            ..........
            ......#...
            .#........
            .........#
            ..........
            .......#..
            #...#.....""";

    private static final String INPUT = """
            ..........................#.........................#........................................................#..............................
            .............#.....................................................#.........#......................#.......................................
            ..................................#....................................................................................#...........#........
            ....................#..........................#..................................................................#.........................
            .......................................................#...............................................................................#....
            .....................................#.........................#......#..............#......................................................
            ........#...............#......................................................#..........#................................#...............#
            .........................................#................#..............................................#............#.....................
            ....#............................#..........................................................................................................
            ............#......................................#..............................................#............#............................
            ......................#.....................................................................#...............................................
            .............................................................................#........#.........................................#...........
            .................#.....................................................#.................................................#..............#...
            ................................#....................#.................................................#....................................
            .......................................#.............................................................................#......................
            ..#.....................#...................................................................................................................
            ............................................#.....................#...........#.....................#.......................................
            ..................................................................................................................#..................#......
            ....................................#....................#................................................................................#.
            .........#.....................................#..............#......................#......................................#...............
            ..............#..........................................................#......................#.....#.....................................
            .......................................................................................................................................#....
            ..................................................................#.........................#...................#...........................
            ....#............................#.....#.....................................#................................................#.............
            .......................#..........................#.........................................................................................
            ..................................................................................#.....#...................#.............#.................
            ................#.............................................#.................................#...........................................
            #.....................................................................................................#...................................#.
            ...........#..............#.....#.............#.....................................................................#.......................
            ...........................................................................#................#.....................................#.........
            ...................................................#........................................................................................
            ..............#....................................................................................#........................................
            .....................................#................................................#.......................#.............................
            .....................................................................................................................................#.....#
            ........#................#....................................#.................................#.........#.................................
            ....................................................#..............#............#....................................#......................
            ....#...............#........#..........................................................#.......................................#...........
            ..........................................#.....#.......................#..........................#.....................................#..
            .......................................................#....................................................................................
            #......#...................................................................................................................#................
            ............#...............................................................................#..........#..........................#.........
            ............................................................................................................#...............................
            .....................................#....................#........#............................#...........................................
            ........................#...........................................................#................................#....................#.
            ......#...............................................#.....................#........................#......................................
            .................................#.....................................#..................................................#.................
            ...................#......................#..................#..........................#.............................................#.....
            .............................#.....................#..............#...........................................#.............................
            .........................................................#.......................................................................#..........
            ...............................................................................#.......................#.................................#..
            ............................................................................................................................................
            ............................................................................................................................................
            .................#.............................................................................................#.......#.............#......
            ....#.....#....................................................#........#...............#....................................#..............
            ..................................#..........#........................................................#.....................................
            ............................................................................................................................................
            ...................#..............................................................................#......................#..................
            ............................................................................................................................................
            ..#..............................................#......#.....#...........................#..............#....................#.............
            ................#......#.........#..........................................................................................................
            .........................................................................#......................................#.........................#.
            ....................................................#..............#............................#...........................................
            .....#....................#..........................................................................#......................................
            ............#...........................#......#............................................................................................
            ............................................................................................................................................
            .....................#.........................................................#.........................#........#.............#...........
            .........#..............................................................#.....................#..........................................#..
            ......................................#...........#.....................................#...................................................
            .#...............................#..........................................................................................................
            ..............#............#....................................#..................................#........................#...............
            .....................................................................#...........................................#..........................
            ............................................................................................................................................
            .........#........#........................#.....#........................#.......................................................#.....#...
            ............................................................................................................................................
            ...................................#........................................................................................................
            ..............#..........#..............#....................................#..........#.....#.............................................
            ....#........................................#............#...................................................................#.............
            ............................................................................................................................................
            #........#......................................................#........#.................................................................#
            ....................#.........#..........................................................................#.......#......#...................
            ............................................................................................................................................
            .......................................#..............#...........................................#.........................................
            ................................................#.............................................................#.......................#.....
            .......................#...................#..............................#.................................................................
            ...............#...................#....................................................#.............................#.....................
            ....#......................................................................................................#................................
            .............................#.........................................#....................#.............................#.....#...........
            ..............................................#..................................................#...................................#......
            ...................#...................#..........................................#.................................#.......................
            ............#.....................#....................#..................#.................................................................
            ...........................................#........................................................#.......................................
            ...........................................................................................................#................................
            ...#............................................................#.............................................................#.............
            .........................#..............................................................#................................................#..
            ...............#............................................................................................................................
            .......................................#.......#.............#..............................................................................
            .....................#...........#.............................................#............#.................#.........#...........#.......
            ..........................................................................#.......................#.........................................
            .......#............................................................................#.......................................................
            ....................................................#....................................................................................#..
            .................#........................................#.....#...........................................................#...............
            .#.........#..................................#.................................#..............#.........#.....#......#.....................
            .....................#............#.......................................................#.........#.......................................
            ............................................................................#.......................................................#.......
            .....................................................................................#....................................#.................
            ............................#................................................................#..................................#...........
            .....#.........................................................#............................................................................
            ......................#..................#............................................................................#.....................
            ................................................................................#.....................................................#.....
            #.................................#.......................................#.................................................................
            ...................#......#.......................#...............#...........................................#.............................
            .............................................................#........................................#......................#..............
            .................................................................................................#..........................................
            ..#..................................#....................................................................#......#..................#.......
            ..........................................................#..................#........................................#.....................
            ..................#........#........................................................#..........................................#............
            .................................#.............#.......................#...................................................................#
            ................................................................................................#.........................#.................
            ....#.....#.................................................................................................................................
            .......................#....................................................#...............................................................
            ....................................................#.......................................................................................
            .............#..............................#..........................................#....................................................
            ...............................#............................................................................................#........#......
            .#.......................................................#.........#...........#.................................#..........................
            ....................................#.............#..............................................................................#..........
            .....................#.........................................................................#......#.....................................
            ..........................#...........................#.........#.................#.........................................................
            ..........#.................................#................................#..............................................................
            ....#...........................................................................................................#..................#........
            ........................................................................#..............#.....................................#..............
            ..................#.......................................#.................................................................................
            ........................................................................................................................................#...
            ....................................................#.......................#..........................#....................................
            .....#..............................#.........................#..................................#..........................................
            ..........................#............................................#........................................#.......#...................
            ..........................................#.................................................................................................
            ......................................................................................................................................#.....
            .......#...........................................#................................#........................................#..............
            #..................#..........................#..........................#.....#............................#...............................
            ...................................#.....................................................................................#..................""";
}
